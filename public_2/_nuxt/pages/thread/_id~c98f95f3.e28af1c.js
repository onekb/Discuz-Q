(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1025:function(t,e,r){},1160:function(t,e,r){"use strict";r(1025)},1249:function(t,e,r){"use strict";r.r(e);r(25),r(53),r(54);var n=r(8),o=r(9),c=(r(34),r(52),r(39),r(24),r(13),r(35),r(31),r(713)),d=r.n(c),h=r(790),l=r.n(h),m=r(915),f=r.n(m),w=r(159),y=r(33),v=r(1159);function k(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function _(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var P="posts.replyUser,threadAudio,user.groups,user,user.groups.permissionWithoutCategories,posts,posts.user,posts.likedUsers,posts.images,firstPost,firstPost.likedUsers,firstPost.images,firstPost.attachments,rewardedUsers,category,threadVideo,paidUsers,question,question.beUser,question.images,onlookers",O={name:"Topic",layout:"custom_layout",mixins:[d.a,l.a,f.a],asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.params,n=t.store,w.a.isSpider){e.next=3;break}return e.abrupt("return",{});case 3:return e.prev=3,e.next=6,n.dispatch("jv/get",["threads/".concat(r.id),{params:{include:P}}]);case 6:return o=e.sent,e.abrupt("return",{thread:o,article:o.firstPost,postId:o.firstPost._jv.id});case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{articleLoading:!0});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})))()},data:function(){return{thread:{},article:{},question:{},redPacket:{},rewardQuestion:{},timer:null,onUpdateRed:!1,onUpdateReward:!1,postId:0,actions:[{text:this.$t("topic.read"),count:0,command:"",canOpera:!1,icon:"book"},{text:this.$t("topic.getLike"),count:0,command:"isLiked",canOpera:!1,isStatus:!1,icon:"like"},{text:this.$t("topic.collection"),command:"isFavorite",canOpera:!1,isStatus:!1,icon:"favor"},{text:this.$t("topic.share"),command:"showLink",canOpera:!0,icon:"link"}],paidInformation:{price:"0",freeWords:0,paid:!1,paidUsers:[],paidCount:0,isPaidAttachment:!1,attachmentPrice:"0"},payment:{wechat_qrcode:"",rewardAmount:""},location:{location:"",latitude:"",longitude:""},managementList:[{name:"canEdit",command:"toEdit",isStatus:!1,canOpera:!1,text:this.$t("topic.edit"),type:"0"},{name:"canEssence",command:"isEssence",isStatus:!1,canOpera:!1,text:this.$t("topic.essence"),type:"1"},{name:"canSticky",command:"isSticky",isStatus:!1,canOpera:!1,text:this.$t("topic.sticky"),type:"2"},{name:"canHide",command:"isDeleted",isStatus:!1,canOpera:!1,text:this.$t("topic.delete"),type:"3"}],showCheckoutCounter:!1,showPasswordInput:!1,showWxPay:!1,defaultLoading:!1,articleLoading:!1,passwordError:!1,passwordErrorTip:"",findPassword:!1}},computed:{threadId:function(){return this.$route.params.id},currentUser:function(){return this.$store.state.user.info.attributes||{}},forums:function(){return this.$store.state.site.info.attributes||{}},rewardOrPay:function(){var t=parseFloat(this.paidInformation.price),e=parseFloat(this.paidInformation.attachmentPrice),r=Object.keys(this.question).length>0?parseFloat(this.question.onlooker_unit_price):0;return t>0||e>0||r>0?"pay":"reward"},payOrRewardAmount:function(){var t=parseFloat(this.paidInformation.price||"0"),e=parseFloat(this.paidInformation.attachmentPrice||"0"),r=Object.keys(this.question).length>0?parseFloat(this.question.onlooker_unit_price):0;return t||e||r||this.payment.rewardAmount},payOrderType:function(){var t=parseFloat(this.paidInformation.price||"0"),e=parseFloat(this.paidInformation.attachmentPrice||"0"),r=Object.keys(this.question).length>0?parseFloat(this.question.onlooker_unit_price):0;return t>0?3:e>0?7:r>0?6:2}},mounted:function(){0===Object.keys(this.thread).length?this.getThread():this.initData()},beforeDestroy:function(){clearInterval(this.timer),this.timer=null},methods:{getThread:function(){var t=this;return this.$store.dispatch("jv/get",["threads/".concat(this.threadId),{params:{include:P}}]).then((function(data){if(data.isDeleted)return t.$router.replace("/error");t.articleLoading=!1,t.thread=data,t.article=data.firstPost,t.postId=t.article._jv.id,t.initData()}),(function(e){return t.handleError(e,"thread")}))},initData:function(){this.initManagementList(this.thread),this.initPaidInformation(this.thread),this.initActions(this.thread,this.article),this.initLocation(this.thread),this.initQuestion(this.thread),this.filterImages(),this.initRedPacket(this.thread),this.initReward(this.thread)},initRedPacket:function(data){var t=this;this.redPacket.isRedPacket=data.isRedPacket,0!==this.redPacket.isRedPacket&&(this.autoUpdateRedpacketStatus(),this.timer=setInterval((function(){t.autoUpdateRedpacketStatus()}),5e3))},autoUpdateRedpacketStatus:function(){var t=this;if(!this.onUpdateRed){if(0===this.redPacket.remain_number)return clearInterval(this.timer);this.onUpdateRed=!0,this.$store.dispatch("jv/get",["redpacket/".concat(this.threadId),{}]).then((function(data){t.redPacket=Object.assign({},t.redPacket,data),t.onUpdateRed=!1}),(function(e){return t.handleError(e,"redpacket")}))}},initReward:function(data){var t=this;5===data.type&&data.questionTypeAndMoney&&0===data.questionTypeAndMoney.type&&(this.rewardQuestion=data.questionTypeAndMoney,this.rewardQuestion.showTime=data.questionTypeAndMoney.expired_at.substr(0,10),this.timer=setInterval((function(){t.autoUpdateRewardStatus()}),5e3))},autoUpdateRewardStatus:function(){var t=this;if(0===this.rewardQuestion.remain_number)return clearInterval(this.timer);this.onUpdateReward||(this.onUpdateReward=!0,y.a.get("threads/".concat(this.threadId),{params:{include:P,stopViewCount:1}}).then((function(data){t.rewardQuestion=Object(v.get)(data,"data.data.attributes.questionTypeAndMoney",{}),t.rewardQuestion.showTime=Object(v.get)(data,"data.data.attributes.questionTypeAndMoney.expired_at","").substr(0,10),t.onUpdateReward=!1})).catch((function(e){t.handleError(e,"reward")})))},filterImages:function(){var t=this;this.article.imageSource=this.article.images,this.article.contentAttachIds&&this.article.contentAttachIds.length>0&&this.article.images&&this.article.images.length>0&&(this.article.images=this.article.images.filter((function(image){return t.article.contentAttachIds.indexOf(image._jv.id)<0})))},initQuestion:function(data){data.question&&(this.question=data.question,this.question.onlookerState=data.onlookerState)},initLocation:function(data){for(var t in this.location)this.location[t]=data[t]},initPaidInformation:function(data){for(var t in this.paidInformation)this.paidInformation[t]=data[t]},initManagementList:function(data){var t=this;this.managementList.forEach((function(e){e.canOpera=data[e.name],"canEssence"===e.name?(e.isStatus=data.isEssence,e.text=e.isStatus?t.$t("topic.cancelEssence"):t.$t("topic.essence")):"canSticky"===e.name&&(e.isStatus=data.isSticky,e.text=e.isStatus?t.$t("topic.cancelSticky"):t.$t("topic.sticky"))})),(4===this.thread.type||5===this.thread.type)&&this.managementList.filter((function(t){return"canEdit"===t.name})).length>0&&(this.managementList.filter((function(t){return"canEdit"===t.name}))[0].canOpera=!1),this.thread.isEssence=data.isEssence,this.managementList=this.managementList.filter((function(t){return t.canOpera}))},initActions:function(data,t){var e=_({},this.actions[0]),r=_({},this.actions[2]),n=_({},this.actions[1]);data&&(e.count=data.viewCount,r.isStatus=data.isFavorite,r.text=r.isStatus?this.$t("topic.collectionAlready"):this.$t("topic.collection"),r.icon=r.isStatus?"favored":"favor",r.canOpera=data.canFavorite),t&&(n.count=t.likeCount,n.isStatus=t.isLiked,n.canOpera=t.canLike,n.text=n.isStatus?this.$t("topic.liked"):this.$t("topic.getLike"),n.icon=n.isStatus?"liked":"like"),this.$set(this.actions,0,e),this.$set(this.actions,1,n),this.$set(this.actions,2,r)},paying:function(t){var e=this,r=t.payWay,n=t.hideAvatar,o=t.rewardAmount;if("reward"===this.rewardOrPay&&(!o||0===parseFloat(o)))return this.$message.error(this.$t("pay.AmountCannotBeLessThan0"));if(this.payment.rewardAmount=o,this.showCheckoutCounter=!1,"walletPay"===r)this.showPasswordInput=!0,this.createOrder(n,this.payOrRewardAmount,this.payOrderType,20).finally((function(){e.defaultLoading=!1}));else if("wxPay"===r){if(!this.forums.paycenter.wxpay_close)return this.$message.warning(this.$t("pay.wxPayClose"));this.createOrder(n,this.payOrRewardAmount,this.payOrderType,10).then((function(){e.payOrder().then((function(t){e.payment.wechat_qrcode=t,e.wxPayActive().then((function(){e.getThread()}),(function(){}))}),(function(){}))})).finally((function(){e.defaultLoading=!1}))}},onPasswordInputCompleted:function(t){var e=this;this.payOrder(t).then((function(){e.getThread()}),(function(){}))},postCommand:function(t){var e=this;if(!this.defaultLoading&&this.isLogin()){this.defaultLoading=!0;var r="isLiked"===t.command?{_jv:{type:"posts",id:this.postId}}:{_jv:{type:"threads",id:this.threadId}};return r[t.command]=!t.isStatus,this.$store.dispatch("jv/patch",r).then((function(data){return data.firstPost&&e.initManagementList(data),data.firstPost&&e.initActions(data),"isSticky"===t.command?t.isStatus?e.$message.success(e.$t("topic.stickySuccess")):e.$message.success(e.$t("topic.cancelStickySuccess")):"isLiked"===t.command?e.setLikeUser(!t.isStatus,data):"isDeleted"===t.command?e.afterDeleted():void 0}),(function(t){return e.handleError(t)})).finally((function(){e.defaultLoading=!1}))}},setLikeUser:function(t,data){var e=this;this.initActions(null,data),t?this.article.likedUsers.unshift(this.currentUser):this.article.likedUsers.forEach((function(t,r,n){t.id===e.currentUser.id&&n.splice(r,1)}))},afterDeleted:function(){var t=this;this.$message({typeInformation:"success",message:this.$t("topic.deleteSuccessAndJumpToBack")}),setTimeout((function(){t.$router.push("/")}),1e3)}},head:function(){return{title:(this.thread&&this.thread.title||this.thread&&this.thread.firstPost&&this.thread.firstPost.content.slice(0,15)||"主题详情页")+(this.forums&&this.forums.set_site&&this.forums.set_site.site_name?" - ".concat(this.forums.set_site.site_name):"‎"),meta:[{hid:"keywords",name:"keywords",content:this.thread.category&&this.thread.category.name||""},{hid:"description",name:"description",content:this.thread.firstPost&&this.thread.firstPost.summaryText.slice(0,80)||""},{name:"og:video",content:this.thread.threadVideo&&this.thread.threadVideo.media_url||""}]}}},$=(r(1160),r(11)),component=Object($.a)(O,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:t.defaultLoading,expression:"defaultLoading",modifiers:{fullscreen:!0}}],staticClass:"page-post",attrs:{"element-loading-background":"rgba(0, 0, 0, 0)"}},[n("main",{directives:[{name:"loading",rawName:"v-loading",value:t.articleLoading,expression:"articleLoading"}]},[n("div",{staticClass:"container-post"},[0===t.thread.isApproved?n("div",{staticClass:"checking"},[t._v("\n        "+t._s(t.thread.threadVideo&&0===t.thread.threadVideo.status?t.$t("topic.VideoTranscoding"):t.$t("topic.examineTip"))+"\n      ")]):t._e(),t._v(" "),n("topic-header",{attrs:{author:t.thread.user||{},thread:t.thread,"management-list":t.managementList,"be-asked-user":t.question&&t.question.beUser?t.question.beUser:{}},on:{managementSelected:t.postCommand}}),t._v(" "),n("topic-content",{attrs:{article:t.article,title:t.thread.title||"",video:t.thread.threadVideo||{},audio:t.thread.threadAudio||{},"paid-information":t.paidInformation,"thread-type":t.thread.type||0,category:t.thread.category||{},location:t.location},on:{payForThread:function(e){t.showCheckoutCounter=!0}}}),t._v(" "),t.redPacket&&1===t.redPacket.isRedPacket?n("div",{staticClass:"desc-text"},[t._v("\n        该主题包含红包，\n        "),n("span",[t._v(t._s(1===t.redPacket.condition?"点赞"+t.redPacket.likenum+"个":"回复"))]),t._v("\n        即可瓜分，共"),n("span",[t._v(t._s(t.redPacket.number))]),t._v("个，已领取\n        "),n("span",[t._v(t._s(t.redPacket.number-t.redPacket.remain_number))]),t._v("个，还剩 "),n("span",[t._v(t._s(t.redPacket.remain_number))]),t._v("个，\n        "),n("span",[t._v("分完即止。")]),t._v(" "),n("img",{staticClass:"desc-logo",attrs:{src:r(1158),alt:"领红包"}})]):t._e(),t._v(" "),t.rewardQuestion&&0===t.rewardQuestion.type?n("div",{staticClass:"desc-text"},[t._v("\n        悬赏于"),n("span",[t._v(t._s(t.rewardQuestion.showTime))]),t._v("日截止， 已分配"),n("span",[t._v(t._s((t.rewardQuestion.money-t.rewardQuestion.remain_money).toFixed(2)))]),t._v("元， 剩下"),n("span",[t._v(t._s(t.rewardQuestion.remain_money))]),t._v("元。\n      ")]):t._e(),t._v(" "),5===t.thread.type&&0!==t.question.type?n("qa-actions",{attrs:{question:t.question||{},"current-user-id":t.currentUser&&t.currentUser.id?t.currentUser.id:"","question-user-id":t.thread.user&&t.thread.user.id?t.thread.user.id:""},on:{answerPublished:function(e){return t.getThread()},payForAnswer:function(e){t.showCheckoutCounter=!0}}}):t._e(),t._v(" "),n("topic-reward-list",{attrs:{author:t.thread.user||{},"paid-count":t.thread.paidCount||0,"rewarded-count":t.thread.rewardedCount||0,"paid-information":t.paidInformation,"can-paid":t.forums&&t.forums.paycenter&&t.forums.paycenter.wxpay_close,"can-reward":t.forums&&t.forums.paycenter&&t.forums.paycenter.wxpay_close&&t.thread.canBeReward,"thread-type":t.thread.type||0,"user-lists":[t.thread.paidUsers||[],t.thread.rewardedUsers||[],t.article.likedUsers||[],[]]},on:{payOrReward:function(e){t.showCheckoutCounter=!0}}}),t._v(" "),n("topic-actions",{attrs:{"thread-id":t.threadId,actions:t.actions||[]},on:{clickAction:t.postCommand}}),t._v(" "),t.showCheckoutCounter?n("topic-checkout-counter",{attrs:{"thread-type":t.thread.type||0,user:t.thread.user||{},amount:t.payOrRewardAmount,content:t.article.summary||"","reward-or-pay":t.rewardOrPay,"be-asked-user":t.question.beUser||{},"ask-or-watch-answer":"watchAnswer"},on:{close:function(e){t.showCheckoutCounter=!1},paying:t.paying}}):t._e(),t._v(" "),t.showPasswordInput?n("topic-password",{attrs:{price:t.payOrRewardAmount,"password-error":t.passwordError,"password-error-tip":t.passwordErrorTip},on:{"update:passwordError":function(e){t.passwordError=e},"update:password-error":function(e){t.passwordError=e},close:function(e){t.showPasswordInput=t.passwordError=!1},password:t.onPasswordInputCompleted,findPassword:t.onFindPassword}}):t._e(),t._v(" "),t.showWxPay?n("topic-wx-pay",{attrs:{"qr-code":t.payment.wechat_qrcode},on:{close:function(e){t.showWxPay=!1}}}):t._e(),t._v(" "),t.findPassword&&t.currentUser.originalMobile?n("find-paypwd",{attrs:{mobile:t.currentUser.mobile,phonenum:t.currentUser.originalMobile},on:{close:function(e){t.findPassword=!1}}}):t._e(),t._v(" "),t.findPassword&&!t.currentUser.originalMobile?n("without-phone",{on:{close:function(e){t.findPassword=!1}}}):t._e(),t._v(" "),n("comment",{attrs:{"thread-id":t.threadId,author:t.thread.user||{},"current-user":t.currentUser,"reward-question":t.rewardQuestion}})],1)]),t._v(" "),n("topic-aside",{attrs:{author:t.thread.user||{}}})],1)}),[],!1,null,"65206f60",null);e.default=component.exports;installComponents(component,{TopicHeader:r(1199).default,TopicContent:r(942).default,QaActions:r(1200).default,TopicRewardList:r(1201).default,TopicActions:r(1202).default,TopicCheckoutCounter:r(922).default,TopicPassword:r(923).default,TopicWxPay:r(892).default,FindPaypwd:r(890).default,WithoutPhone:r(891).default,Comment:r(1203).default,TopicAside:r(944).default})},786:function(t,e,r){"use strict";r(52);e.a=function(t){return t[0]===t[1]&&"0"===t[0]&&(t=t.substr(0,1)),t.replace(/[^\d.]/g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(-)*(\d+)\.(\d\d).*$/,"$1$2.$3").replace(/^\./g,"")}}}]);